<script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.1/masonry.pkgd.min.js"></script> <!-- Script for Masonary Grid for Thumbnails -->
<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <!-- Script to wait until images are loaded before constructing Masonary Grid -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/screenfull.js/5.1.0/screenfull.min.js"></script> <!-- Script for fullscreen functionality -->

<script>

   /* Section purpose: give an ID to each picture collection item */
   $(document).ready(function(){
      $('.w-dyn-item').each(function() {
         $(this).attr('id', 'picture-'+ $(this).children('.hidden-picture-number').text().trim());
      });
   });

   var thumbnails = document.getElementsByClassName("photo-series-picture-data");
   var numberOfPictures = thumbnails.length; 


   /* Section purpose: helper functions */


   /* This is very hacky and might break in the future, find a better way Choucri */
   var isMobile = function() {
      let check = false;
      (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
    return check;
   };

   var getPictureCatpion = function(element) {
      return element.getElementsByClassName("hidden-picture-caption")[0].textContent; 
   };
   
   var getPictureNumber = function(element) {
      return element.getElementsByClassName("hidden-picture-number")[0].textContent;
   }
   
   var getPictureImageUrl = function(element) {
      return element.getElementsByClassName("photo-series-image")[0].getAttribute("src"); 
   }
   
   var wrapAroundUrlTerm = function(url) {
      return "url('" + url + "')"
   }
   
   var isLeftEdgeReached = function(pictureNumber) {
     return pictureNumber == 1; 
   }
   
   var isRightEdgeReached = function(pictureNumber) {
     return pictureNumber == numberOfPictures; 
   }

   var isWindowFullscreenMode = function() {
     return document.getElementById('navbar').style.display === "none";
   }
   
   var updateCursors = function(pictureNumber) {
      if (isLeftEdgeReached(pictureNumber)) {
         document.getElementById('gallery-lower-left-section').style.cursor = "auto";
         document.getElementById('gallery-lower-right-section').style.cursor = "url('https://uploads-ssl.webflow.com/602e8d61b48fab24c169405e/605a69bb143b8f027d6831ff_chevron-right-icon-25px.png'), e-resize";
      }
      else if (isRightEdgeReached(pictureNumber)) {
         document.getElementById('gallery-lower-right-section').style.cursor = "auto";
         document.getElementById('gallery-lower-left-section').style.cursor = "url('https://uploads-ssl.webflow.com/602e8d61b48fab24c169405e/605a6a4d596dd435ee6402f1_chevron-left-icon-25px.png'), w-resize"
     }
     else {
        document.getElementById('gallery-lower-right-section').style.cursor = "url('https://uploads-ssl.webflow.com/602e8d61b48fab24c169405e/605a69bb143b8f027d6831ff_chevron-right-icon-25px.png'), e-resize";
        document.getElementById('gallery-lower-left-section').style.cursor = "url('https://uploads-ssl.webflow.com/602e8d61b48fab24c169405e/605a6a4d596dd435ee6402f1_chevron-left-icon-25px.png'), w-resize"
     }
   }

   var triggerMasonaryGridOrdering = function () {
      var elem = document.querySelector('.photo-series-pictures-data');
      var msnry = new Masonry(elem, {
         itemSelector: '.photo-series-picture-data',
         horizontalOrder: true
      });
    };

   /* Masonary Grid for thumbnails */ 
   window.addEventListener("load", triggerMasonaryGridOrdering, false); 

   /* Section purpose: Night Mode */

   var invertIconColors = function (number) {
      var icons = document.getElementsByClassName('icon');
      for (var i = 0; i < icons.length; i++) {
         icons[i].style.webkitFilter = "invert(" + number + ")";
      }
      document.getElementById('gallery-lower-left-section').style.webkitFilter = "invert(" + number + ")";
   }
   
   var nightModeIcon = document.getElementById("night-mode-icon");
   nightModeIcon.addEventListener('click', function (){
      invertIconColors(1);
      }, false);
      
   var lightModeIcon = document.getElementById("light-mode-icon");
   lightModeIcon.addEventListener('click', function (){
      invertIconColors(0);
      }, false);


   /* Section purpose: Fullscreen Modes (Window and Browser) */
      
   var hideText = function () {
    
      document.getElementById("picture-caption").style.display = "none";
      document.getElementById("picture-counter").style.display = "none";

  
      document.getElementById("show-text-icon").style.display = "block";
      document.getElementById("hide-text-icon").style.display = "none";

      if (isMobile()) {
        document.getElementById("fullscreen-icons-and-picture-counter").style.minWidth = "0px"; 
        document.getElementById("fullscreen-navigation-icons").style.position = "fixed"; 
        document.getElementById("fullscreen-navigation-icons").style.top = "10px"; 
        document.getElementById("fullscreen-navigation-icons").style.right = "10px"; 
      }
   }
   
   var showText = function () {
      document.getElementById("picture-caption").style.display = "block";
      document.getElementById("picture-counter").style.display = "block";

      if (isMobile()) {
        document.getElementById("show-text-icon").style.display = "none";
        // On mobile, reset the single picture overlay top position to its default so the picture doesn't overlap with the caption
        document.getElementById("single-picture-overlay").style.top = "-20px";

      }
      else {
        document.getElementById("show-text-icon").style.display = "none";
      }
      

      /* Only show the desktop "enter fullscreen" icon if we're on desktop. That is because on Mobile
      another icon is used, it's always displayed on mobile, and we don't want to show the desktop icon here,
      else we end up with two icons, the mobile one and the desktop one. */
      if (!isMobile()) {
        document.getElementById("hide-text-icon").style.display = "block";
      }
      
      document.getElementById("fullscreen-icons-and-picture-counter").style.minWidth = "80px"; 
      document.getElementById("fullscreen-navigation-icons").style.position = "static"; 
   }

   var enterBrowserFullscreen = function() {
      screenfull.request();

      document.getElementById("enter-browser-fullscreen-icon").style.display = "none";
      document.getElementById("exit-browser-fullscreen-icon").style.display = "block";
    }

    var exitBrowserFullscreen = function() {
      screenfull.exit();

      document.getElementById("enter-browser-fullscreen-icon").style.display = "block";
      document.getElementById("exit-browser-fullscreen-icon").style.display = "none";

      // Retrigger masony grid because layout can break when entering / exiting window and browser fullscreen. 
      triggerMasonaryGridOrdering();
    }
   
   var hideTextIcon = document.getElementById("hide-text-icon");
   hideTextIcon.addEventListener('click', hideText, false);
   
   var showTextIcon = document.getElementById("show-text-icon");   
   showTextIcon.addEventListener('click', showText, false); 

   var enterBrowserFullscreenIcon = document.getElementById("enter-browser-fullscreen-icon");   
   enterBrowserFullscreenIcon.addEventListener('click', enterBrowserFullscreen, false);   
   
   var exitBrowserFullscreenIcon = document.getElementById("exit-browser-fullscreen-icon");   
   exitBrowserFullscreenIcon.addEventListener('click', exitBrowserFullscreen, false); 
  


   /* Section purpose: main functions for lightbox actions */
     
   var openPictureOverlay = function() {
     

     document.getElementById("navbar").style.display = "none";
     document.getElementsByTagName('body')[0].style.overflow = "hidden";
     
     document.getElementById("photo-series-gallery-wrapper").scrollTo(0,0); 
     
     var pictureCaption = getPictureCatpion(this);
     var pictureNumber = getPictureNumber(this);    
     var imageURL = getPictureImageUrl(this);
		 var imageURLWithURLTerm = wrapAroundUrlTerm(imageURL)
 
     document.getElementById("single-picture-container").style.backgroundImage = imageURLWithURLTerm;     
     document.getElementById("picture-caption").textContent = pictureCaption;
     document.getElementById("picture-counter").textContent = pictureNumber + " / " + numberOfPictures; 

     document.getElementById("single-picture-overlay").style.display = "flex";      
     document.getElementById("photo-series-gallery-wrapper").style.overflow = "hidden";
  
     updateCursors(pictureNumber);

     
   };

   var closePictureOverlay = function() {


     document.getElementById("navbar").style.display = "block";
     document.getElementsByTagName('body')[0].style.overflow = "visible";

     document.getElementById("single-picture-overlay").style.display = "none";      
     document.getElementById("photo-series-gallery-wrapper").style.overflow = "auto";
     
     // Retrigger masony grid because layout can break when entering / exiting window and browser fullscreen. 
     triggerMasonaryGridOrdering();
   }
   
   var nextPicture = function() {
     
     /* Get current picture number */
     var currentPictureNumber = document.getElementById("picture-counter").textContent.split("/")[0].trim();
     
     if (currentPictureNumber != numberOfPictures) {
       /* Get data from next picture */
       var nextPictureNumber = Number(currentPictureNumber) + 1
       var nextPictureCollectionItemId = "picture-" + nextPictureNumber;
       var nextPictureCollectionItem = document.getElementById(nextPictureCollectionItemId);

       var nextPictureCaption = getPictureCatpion(nextPictureCollectionItem);     
       var imageURL = getPictureImageUrl(nextPictureCollectionItem);
       var imageURLWithURLTerm = wrapAroundUrlTerm(imageURL)

       document.getElementById("single-picture-container").style.backgroundImage = imageURLWithURLTerm;     
       document.getElementById("picture-caption").textContent = nextPictureCaption;
       document.getElementById("picture-counter").textContent = nextPictureNumber + " / " + numberOfPictures;

       updateCursors(nextPictureNumber);
     }
   };
   
   var previousPicture = function() {
     
     /* Get current picture number */
     var currentPictureNumber = document.getElementById("picture-counter").textContent.split("/")[0].trim();
     
     if (currentPictureNumber != 1) {
       /* Get data from previous picture */
       var previousPictureNumber = Number(currentPictureNumber) - 1
       var previousPictureCollectionItemId = "picture-" + previousPictureNumber;
       var previousPictureCollectionItem = document.getElementById(previousPictureCollectionItemId);

       var previousPictureCaption = getPictureCatpion(previousPictureCollectionItem);     
       var imageURL = getPictureImageUrl(previousPictureCollectionItem);
       var imageURLWithURLTerm = wrapAroundUrlTerm(imageURL)

       document.getElementById("single-picture-container").style.backgroundImage = imageURLWithURLTerm;     
       document.getElementById("picture-caption").textContent = previousPictureCaption;
       document.getElementById("picture-counter").textContent = previousPictureNumber + " / " + numberOfPictures;

       updateCursors(previousPictureNumber);
     }
   };


  /* Mobile swipe left / right / up gestures */

   var xDown = null;                                                        
   var yDown = null;

   function getTouches(evt) {
     return evt.touches ||             // browser API
            evt.originalEvent.touches; // jQuery
   }                                                     

   function handleTouchStart(evt) {
       const firstTouch = getTouches(evt)[0];                                      
       xDown = firstTouch.clientX;                                      
       yDown = firstTouch.clientY;                                      
   };                                                

   function handleTouchMove(evt) {
       if ( ! xDown || ! yDown ) {
           return;
       }

       var xUp = evt.touches[0].clientX;                                    
       var yUp = evt.touches[0].clientY;

       var xDiff = xDown - xUp;
       var yDiff = yDown - yUp;

       if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {
           if ( xDiff > 0 ) {
               nextPicture();
           } else {
               previousPicture();
           }                       
       } else {
           if ( yDiff > 0 ) {
               closePictureOverlay();

           } else { 
               closePictureOverlay();
           }                                                                 
       }

       /* reset values */
       xDown = null;
       yDown = null;                                             
   };
    
   var galleryGridOverlay = document.getElementById("gallery-grid-overlay");
   galleryGridOverlay.addEventListener('touchstart', handleTouchStart, false);
   galleryGridOverlay.addEventListener('touchmove', handleTouchMove, false);   

   /* Section purpose: set up listeners for lightbox actions */
 
   for (var i = 0; i < thumbnails.length; i++) {
     thumbnails[i].addEventListener('click', openPictureOverlay, false);
   }
   
   var galleryUpperSection = document.getElementById("gallery-upper-section");
   var galleryLowerRightSection = document.getElementById("gallery-lower-right-section");
   var galleryLowerLeftSection = document.getElementById("gallery-lower-left-section");
   galleryLowerLeftSection.addEventListener('click', previousPicture, false);
   galleryLowerRightSection.addEventListener('click', nextPicture, false);
   galleryUpperSection.addEventListener('click', closePictureOverlay, false);

   
   var pictureOverlayCloseIcon = document.getElementById("single-picture-overlay-close-icon");
   pictureOverlayCloseIcon.addEventListener('click', closePictureOverlay, false);
   

   $(document).on('keyup', function(event) {
      // Left Arrow Key
      if (event.which === 37) { 
          $('.gallery-lower-left-section').click();
      } 
      // Right Arrow Key
      else if (event.which === 39) { 
          $('.gallery-lower-right-section').click();
      }
      // Up Arrow Key or ESC key
      else if (event.which === 38 || event.which === 27) {
          closePictureOverlay();
      } 
   });   

</script>